name: Secret scan (basic)

on:
  push:
    branches: [ main, master, 'cirujano-copilot' ]
  pull_request:

jobs:
  secret-scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Basic secret search
        run: |
          echo "Looking for obvious secrets (SECRET_KEY, JWT_SECRET) in committed files..."
          set -e
          FOUND=0
          for PATTERN in "SECRET_KEY" "JWT_SECRET" "JWT_REFRESH_SECRET" "AWS_SECRET_ACCESS_KEY" "PRIVATE_KEY"; do
            if git grep -n -- "${PATTERN}" || true; then
              FOUND=1
            fi
          done
          if [ "$FOUND" -eq 1 ]; then
            echo "Potential secret-like strings found in the repository. Please verify and remove before merging." >&2
            exit 1
          fi
          echo "No obvious secret patterns found."
